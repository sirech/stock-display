var config={template:stockConfigTemplate()},YAHOO={Finance:{SymbolSuggest:{}}};
function setupTitle(){var a=$("#title div #title_field");a.val(getTitle());a.val()!=getDefaultTitle()&&a.removeClass("example");a.focus(function(){a.val()===getDefaultTitle()&&a.removeClass("example").val("")}).blur(function(){a.val()===""&&a.addClass("example").val(getDefaultTitle())}).keyup(function(){localStorage.title=a.val()});$("#search_field").focus(function(){$(this).removeClass("example").val("")}).blur(function(){$(this).addClass("example").val(chrome.i18n.getMessage("example",["Apple"]))})}
function persist(){var a=[];$("#stocks ul .stock").each(function(c,b){var d={id:$(b).find(".stock_id").text(),name:$(b).find(".stock_name").text()};a.push(d)});storeStocks(a)}function stockExists(a){var c,b=loadStocks();for(c=0;c<b.length;c++)if(b[c].id===a)return true;return false}function removeStock(a){a.fadeOut("slow",function(){a.remove();persist()})}
function addStock(a,c){var b=config.template.clone();b.find(".stock_name").html(a.name);b.find(".stock_id").html(a.id);b.find(".delete").click(function(){removeStock($(this).parent());return false});$("#stocks ul").append(b);b.fadeIn("slow");c&&persist()}function unpersist(){var a,c;a=loadStocks();for(c=0;c<a.length;c++)addStock(a[c],false)}function showResults(a,c){a($.map(c,function(b){return{label:b.name+" ("+b.symbol+")"+(b.exchDisp?" in "+b.exchDisp:""),value:{id:b.symbol,name:b.name}}}))}
function setupLookup(){$("#search_field").autocomplete({source:function(a,c){$.ajax({type:"GET",url:"http://d.yimg.com/autoc.finance.yahoo.com/autoc",data:{query:a.term},dataType:"jsonp",jsonpCallback:"YAHOO.Finance.SymbolSuggest.ssCallback"});YAHOO.Finance.SymbolSuggest.ssCallback=function(b){showResults(c,b.ResultSet.Result)}},select:function(a,c){var b=c.item.value;stockExists(b.id)||addStock(b,true);$("#search_field").val(b.name);return false},focus:function(a,c){var b=c.item.value;$("#search_field").val(b.name);
return false},open:function(){$(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){$(this).removeClass("ui-corner-top").addClass("ui-corner-all")}})}
jQuery(function(){$("#stocks ul").sortable({handle:".handle",update:function(){persist()}}).disableSelection();document.title=chrome.i18n.getMessage("options_title",[chrome.i18n.getMessage("extension_name")]);$("#title div #give_title").text(chrome.i18n.getMessage("give_title"));$("#stocks_header div #start").text(chrome.i18n.getMessage("start"));$("#stocks_header div #search_field").val(chrome.i18n.getMessage("example",["Apple"]));$("#usage #help_start").text(chrome.i18n.getMessage("help_start"));
$("#usage #help_comp").text(chrome.i18n.getMessage("help_comp"));$("#usage #help_drag").text(chrome.i18n.getMessage("help_drag"));setupTitle();unpersist();setupLookup()});
