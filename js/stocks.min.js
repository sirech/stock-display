(function(){function l(){c.format={last_time:0,name:1,last_price:2,percent_change:3,change:4,symbol:5};return QUERY.options("last_time","name","last_price","percent_change","change","symbol")}function i(a){c.stocks.length!==0&&QUERY.send(QUERY.build(a,l()),m)}function n(a,b){var e,d="http://ichart.finance.yahoo.com/";if(b===c.chartArguments.today||b===c.chartArguments.lastWeek){d+=b+"?s=";e="&"}else{d+="c/"+b+"/";e="?"}return d+a+e+Math.floor(Math.random()*1E6)}function h(a,b){var e,d;e=c.chartArguments[load("time")]||
c.chartArguments.today;$("#chart").data("id",a);$("#chart ul").find("#"+load("time")).addClass("ui-state-active").siblings().removeClass("ui-state-active");d=new Image;d.src=n(a,e);d.onload=function(){$("#chart img").remove();b?$("#chart").append(d):$("#chart").append(d).effect("slide")}}function o(a){var b=c.template.clone().data("id",a.id).attr("title",a.id).show();b.find(".stock_name").text(a.name);b.click(function(){$(this).addClass("selected").siblings().removeClass("selected");h($(this).data("id"));
return false}).mouseenter(function(){$(this).addClass("highlighted").siblings().removeClass("highlighted");return false});b.find(".stock_chg").click(function(){p();return false});return b}function q(){var a,b;if(c.stocks.length===0){r();return false}for(a=0;a<c.stocks.length;a++){b=o(c.stocks[a]);$("#stocks ul").append(b)}return true}function m(a){var b,e,d,j,k;b=QUERY.parseCsv(a);e=0;d=(a=getBoolKey($("#stocks"),"price_chg"))?c.format.change:c.format.percent_change;j=a?c.format.percent_change:c.format.change;
$("#stocks ul .stock").each(function(s,g){var f=b[e];if(f[c.format.symbol]===$(g).data("id")){k=f[d].charAt(0)==="+"?"up":f[d].charAt(0)==="-"?"down":"neutral";$(g).find(".stock_price").text(f[c.format.last_price]);$(g).find(".stock_chg").removeClass("up down neutral").addClass(k).data("alt",f[j]).text(f[d]);e++}else{$(g).find(".stock_price").text("-");$(g).find(".stock_chg").removeClass("up down neutral").addClass("neutral").data("alt","-").text("-")}});$("#chart img").length!=0&&h($("#chart").data("id"),
true)}function r(){$("#empty").show().find("a").click(function(){window.open(chrome.extension.getURL("options.html"));window.close();return false});$("#title").hide();$("#disclaimer").hide();$("#last_update").hide()}function p(){toggleKey($("#stocks"),"price_chg");$("#stocks ul .stock .stock_chg").each(function(a,b){swap($(b),"alt")})}var c={format:{},stocks:loadStocks(),template:stockTemplate(),chartArguments:{today:"b",lastWeek:"w",threeMonths:"3m",sixMonths:"6m",lastYear:"1y",twoYears:"2y",fiveYears:"5y",
max:"my"}};jQuery(function(){$("#status").ajaxStart(function(){$(this).show()});$("#status").ajaxError(function(){$(this).hide()});$("#status").ajaxStop(function(){$(this).fadeOut(2E3)});$("#title").click(function(){window.open(chrome.extension.getURL("standalone.html"));window.close();return false}).mouseenter(function(){$(this).addClass("title_highlight");return false}).mouseleave(function(){$(this).removeClass("title_highlight");return false}).attr("title",chrome.i18n.getMessage("help_standalone")).text(getTitle());
$("#disclaimer").text(chrome.i18n.getMessage("disclaimer"));$("#empty a").text(chrome.i18n.getMessage("empty_add"));$("#time_options li").addClass("ui-state-default").click(function(){store("time",$(this).attr("id"));h($("#chart").data("id"));return false});if(q()){i(c.stocks);window.setInterval(function(){i(c.stocks)},45E3)}})})();
